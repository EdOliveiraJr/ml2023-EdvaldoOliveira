define(["require","exports","tslib","react","external/react-redux","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/open_button/open_button","modules/clean/react/file_viewer/share_helpers","modules/clean/react/title_bar/controls_container","modules/clean/react/user_notifications/dropdown","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/clean/react/size_class/constants","modules/core/i18n","modules/core/browser_detection","modules/clean/react/paper/utils","modules/clean/react/paper/open_in_paper_button","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/extensions/client","modules/clean/react/file_viewer/data/selectors","modules/clean/react/extensions/split_share_button","modules/clean/react/extensions/utils","modules/clean/integrations/zoom_share_dialog/async_modal","modules/clean/react/extensions/data/types","modules/clean/sharing/constants"],function(e,t,n,o,r,a,i,s,l,u,c,p,d,h,f,m,_,S,v,C,w,I,y,B,P,g,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),u=n.__importStar(u);var E=function(e,t){u.share(e,t,null,k.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE),a.logUserAction(i.UserAction.Share,i.UserActionContext.TitleBarMain)},D=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.cancelGetSharedLinkInfo=function(){},t.handleShareMenuItemClick=function(){E(t.props.file,t.props.user)},t.removeShareLink=function(){var e=new d.ShareApiClient({userId:t.props.user.id}),n=t.state.linkMetadata,o=n.name,r=n.url;h.deleteLinkWithConfirm({client:e,contentName:o,onCancel:null,onDeleteLink:function(){return t.setState({linkMetadata:void 0})},url:r})},t}return n.__extends(t,e),t.prototype.setupShare=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,o,r;return n.__generator(this,function(n){switch(n.label){case 0:return e=!1,this.cancelGetSharedLinkInfo=function(){e=!0},t=new d.ShareApiClient({userId:this.props.user.id}),[4,t.sharedLinkInfo({fileIdOrPath:this.props.file.fq_path})];case 1:return o=n.sent(),r=o[0],e||this.setState({linkMetadata:r}),this.cancelGetSharedLinkInfo=function(){},[2]}})})},t.prototype.componentDidMount=function(){this.setupShare()},t.prototype.componentDidUpdate=function(e){e.file!==this.props.file&&(this.cancelGetSharedLinkInfo(),this.setState({linkMetadata:void 0}),this.setupShare())},t.prototype.componentWillUnmount=function(){this.cancelGetSharedLinkInfo()},t.prototype.render=function(){var e=this.props,t=e.file,n=e.extensionsConfig,r=e.sizeClass,a=e.user,i=!!this.state.linkMetadata&&this.state.linkMetadata.link_permissions.can_revoke,l=r===f.SizeClass.Small,u=S.getOpenInPaperButtonVariant({file:t,user:a});return o.default.createElement(s.MoreDropdown,{allowRemoveLink:i,isPrivate:!0,file:t,onClickShareLink:this.handleShareMenuItemClick,onRemoveShareLink:this.removeShareLink,sizeClass:r,user:a,showOpenInPaper:u===S.OpenInPaperButtonVariant.Ellipsis&&!l,extensionsConfig:n})},t})(o.default.PureComponent);t.UnconnectedMountedFileMoreDropdown=D,t.MountedFileMoreDropdown=r.connect(function(e){return{extensionsConfig:I.getExtensionsConfig(e)}})(D);var x=(function(r){function s(){var t=null!==r&&r.apply(this,arguments)||this;return t.handleSplitShareButtonShareClick=function(){E(t.props.file,t.props.user)},t.handleShareButtonClick=function(){return n.__awaiter(t,void 0,void 0,function(){var t,o,r;return n.__generator(this,function(a){switch(a.label){case 0:return E(this.props.file,this.props.user),[4,new Promise(function(t,n){e(["modules/clean/react/app_actions/telemetry_client"],t,n)}).then(n.__importStar)];case 1:return t=a.sent(),o=t.createTelemetryClient,r=t.getPiiSafeExtension,o({component:"share-btn"}).session({surface:"previews",ext:r(this.props.file.ext)}).event("click_share",{trigger_type:g.TriggerType.PrimaryButton}),[2]}})})},t.handlePresentInZoom=function(){var e=t.props,n=e.user,o=e.file;P.asyncShowModal(n.id,o.file_id,"file-viewer-modal-overlay")},t}return n.__extends(s,r),s.getDerivedStateFromProps=function(e){return{openInPaperButtonVariant:S.getOpenInPaperButtonVariant({file:e.file,user:e.user})}},s.prototype.logUserActionInTitleBarFactory=function(e){return function(){return a.logUserAction(e,i.UserActionContext.TitleBarMain)}},s.prototype.render=function(){var e=this.props,n=e.file,r=e.extensionsConfig,a=e.sizeClass,s=e.shouldDisplayActionButtons,u=e.user;if(a!==f.SizeClass.Large){var d=null;return s&&!_.is_mobile_or_tablet()&&a!==f.SizeClass.Small&&(r.displayState===w.DisplayState.ENABLED?d=o.default.createElement("div",{className:"control__button"},o.default.createElement(C.ExtensionsMenu,{user:u,file:n,showAsButtonIfDownloadOnly:!0,hasOpenInPaperSupport:this.state.openInPaperButtonVariant===S.OpenInPaperButtonVariant.Dropdown,telemetryContext:{surface:"previews"},showBigTooltip:!0,onPresentInZoom:this.handlePresentInZoom})):r.displayState===w.DisplayState.DISABLED&&(d=o.default.createElement(l.OpenButton,{file:n,location:i.FileViewerPane.TitleBar,user:u}))),o.default.createElement(c.TitleBarControlsContainer,null,d,o.default.createElement(t.MountedFileMoreDropdown,{file:this.props.file,user:this.props.user,sizeClass:this.props.sizeClass}))}var h;s&&(h=B.shouldShowSplitShare(r,n)?[o.default.createElement(y.SplitShareButton,{user:u,file:n,onShowShare:this.handleSplitShareButtonShareClick,context:{surface:"previews"},variant:"primary",showEduTooltip:!0,onPresentInZoom:this.handlePresentInZoom})]:[o.default.createElement("button",{className:"share-button button-primary control__button",onClick:this.handleShareButtonClick,key:0},m._("Share"))],this.state.openInPaperButtonVariant===S.OpenInPaperButtonVariant.Button&&h.push(o.default.createElement(v.OpenInPaperButton,{key:"openinpaper",file:n,user:u,hideCallout:!1})),r.displayState===w.DisplayState.ENABLED?h.push(o.default.createElement("div",{className:"control__button"},o.default.createElement(C.ExtensionsMenu,{user:u,file:n,showAsButtonIfDownloadOnly:!0,hasOpenInPaperSupport:this.state.openInPaperButtonVariant===S.OpenInPaperButtonVariant.Dropdown,telemetryContext:{surface:"previews"},showBigTooltip:!0,onPresentInZoom:function(){}}))):r.displayState===w.DisplayState.DISABLED&&h.push(o.default.createElement(l.OpenButton,{file:n,location:i.FileViewerPane.TitleBar,user:u,key:2,sizeClass:this.props.sizeClass,hasOpenInPaperSupport:this.state.openInPaperButtonVariant===S.OpenInPaperButtonVariant.Dropdown})));var I=u.is_guest_admin?"":o.default.createElement(p.UserNotificationsDropdown,{isPagelet:!1,onClick:this.logUserActionInTitleBarFactory(i.UserAction.ClickNotifications)});return o.default.createElement(c.TitleBarControlsContainer,null,h,o.default.createElement(t.MountedFileMoreDropdown,{file:this.props.file,user:this.props.user,sizeClass:this.props.sizeClass}),o.default.createElement("div",{className:"react-title-bar__divider"}),I)},s})(o.default.Component);t.UnconnectedMountedFileActions=x;var M=function(e){return{extensionsConfig:I.getExtensionsConfig(e)}};t.MountedFileActions=r.connect(M)(x)});
//# sourceMappingURL=mounted_file_actions.min.js-vflAumy_g.map